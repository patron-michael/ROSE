```{r initial test, prompt=FALSE, echo=FALSE}
library(ROSE)
data(hacide)
library(knitr)
library(rmarkdown)

# unbalance on training set
table(hacide.train$cls, )
#unbalance on test set
table(hacide.test$cls)

# plot unbalanced data highlighting the majority and 
# minority class examples.
par(mfrow=c(1,2))
plot(hacide.train[, 2:3], main="Unbalanced data", xlim=c(-4,4),
     ylim=c(-4,4), col=as.numeric(hacide.train$cls), pch=20)
legend("topleft", c("Majority class","Minority class"), pch=20, col=1:2)

# model estimation using logistic regression
fit <- glm(cls~., data=hacide.train, family="binomial")
# prediction using test set
pred <- predict(fit, newdata=hacide.test)
roc.curve(hacide.test$cls, pred,
          main="ROC curve \n (Half circle depleted data)")

# generating data according to ROSE: p=0.5 as default
data.rose <- ROSE(cls~., data=hacide.train, seed=3)$data
table(data.rose$cls)

par(mfrow=c(1,2))
# plot new data generated by ROSE highlighting the 
# majority and minority class examples.
plot(data.rose[, 2:3], main="Balanced data by ROSE",
     xlim=c(-6,6), ylim=c(-6,6), col=as.numeric(data.rose$cls), pch=20)
legend("topleft", c("Majority class","Minority class"), pch=20, col=1:2)

fit.rose <- glm(cls~., data=data.rose, family="binomial")
pred.rose <- predict(fit.rose, data=data.rose, type="response")
roc.curve(data.rose$cls, pred.rose, 
          main="ROC curve \n (Half circle depleted data balanced by ROSE)")
par(mfrow=c(1,1))
```


```{r sepcific example train data, prompt=FALSE, echo=FALSE}
library("tidyverse")
# unbalance on training set
table(hacide.train$cls)

multiclass_balance_init_train <- hacide.train %>%
    count(cls) %>%
    mutate(prop = n/sum(n))

ggplot(multiclass_balance_init_train, aes(x=cls, y=prop, fill=n)) +
  geom_bar(stat="identity") + ggtitle(label="unbalance train") + scale_fill_continuous(name = "number of elements")

paged_table(multiclass_balance_init_train)
```

```{r sepcific example test data, prompt=FALSE, echo=FALSE}
#unbalance on test set
table(hacide.test$cls)

multiclass_balance_init_test <- hacide.test %>%
    count(cls) %>%
    mutate(prop = n/sum(n))

ggplot(multiclass_balance_init_test, aes(x=cls, y=prop, fill=n)) +
  geom_bar(stat="identity") + ggtitle(label="unbalance test") + scale_fill_continuous(name = "number of elements")

paged_table(multiclass_balance_init_test)
```

```r
resampling_train <- ovun.sample(cls~. ,data=hacide.train, method = "both")
```

```{r resampling train data, prompt=FALSE, echo=FALSE}
resampling_train <- ovun.sample(cls~. ,data=hacide.train, method = "both")

multiclass_balance_train <- resampling_train$data %>%
    count(cls) %>%
    mutate(prop = n/sum(n))

ggplot(multiclass_balance_train, aes(x=cls, y=prop, fill=n)) +
  geom_bar(stat="identity") + ggtitle(label="unbalance train") + scale_fill_continuous(name = "number of elements")

paged_table(multiclass_balance_train)
```

```r
resampling_test <- ovun.sample(cls~. ,data=hacide.test, method = "both")
```

```{r resampling test data, prompt=FALSE, echo=FALSE}
resampling_test <- ovun.sample(cls~. ,data=hacide.test, method = "both")

multiclass_balance_test <- resampling_test$data %>%
    count(cls) %>%
    mutate(prop = n/sum(n))

ggplot(multiclass_balance_test, aes(x=cls, y=prop, fill=n)) +
  geom_bar(stat="identity") + ggtitle(label="unbalance test") + scale_fill_continuous(name = "number of elements")

paged_table(multiclass_balance_test)
```